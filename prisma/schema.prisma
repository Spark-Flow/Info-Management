// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Gender {
  MALE
  FEMALE
}

enum CivilStatus {
  SINGLE
  MARRIED
  WIDOWED
  SEPARATED
  DIVORCED
}

enum ClassList {
  KINDER1
  KINDER2
  GRADE1
  GRADE2
  GRADE3
  GRADE4
  GRADE5
  GRADE6
  GRADE7
  GRADE8
  GRADE9
  GRADE10
}

enum PaymentFeeType {
  TUITION_FEE
  MISCELLANEOUS_FEE
  BOOKS
  UNIFORM
  FIELD_TRIP
  SCHOOL_SUPPLIES
  SCHOOL_SERVICE
  OTHERS
  SCHOOL_ID
  FOUNDATION_TSHIRT
  GRADUATION_FEE
  RECOGNITION_FEE
  FORM_137
  CERTIFICATIONS
  ENTRANCE_FEE
}

enum ModeOfPayment {
  CASH
  CHECK
  CREDIT_CARD
  GCASH
  PAYMAYA
  ONLINE_BANKING
}

enum PaymentStatus {
  PAID
  UNPAID
  PARTIAL
}

enum PaymentFrequency {
  MONTHLY
  QUARTERLY
  SEMI_ANNUAL
  ANNUAL
}

// Model for Teachers
// A Teacher can teach multiple subjects
model Teachers {
  id             String      @id @default(uuid())
  email          String
  teacher_number String      @unique
  first_name     String
  last_name      String
  middle_name    String?
  birthday       DateTime    @default("2000-01-01T00:00:00Z")
  gender         Gender
  nationality    String
  religion       String
  civil_status   CivilStatus
  address_line1  String
  address_line2  String?
  city           String
  zip_code       String
  cell_number    String
  imageUrl       String?
  SSS            String?
  PAGIBIG        String?
  PHILHEALTH     String?
  TIN            String?
  date_joined    DateTime
  date_resigned  DateTime?

  subjects Subjects[] @relation("TeacherToSubject")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Model for Students
// A Student can have multiple payments, a student can only be part of one class
model Students {
  id                String   @id @default(uuid())
  student_number    String   @unique
  first_name        String
  last_name         String
  middle_name       String?
  birthday          DateTime @default("2000-01-01T00:00:00Z")
  gender            Gender   @default(MALE)
  nationality       String
  religion          String
  address_line1     String
  address_line2     String?
  city              String
  zip_code          String
  cell_number       String
  imageUrl          String?
  father_name       String
  father_occupation String?
  mother_name       String
  mother_occupation String?
  guardian_name     String?
  guardian_relation String?
  guardian_number   String?
  guardian_address  String?

  Payment Payment[]
  classId String
  Classes Classes   @relation("StudentToClass", fields: [classId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Model for Classes, Kinder to Grade 10
// One to Many Relationship with Subjects
// One to One Relationship iwth a payment fee structure payment fee
model Classes {
  id   String    @id @default(uuid())
  name ClassList @unique

  Subjects Subjects[] @relation("ClassToSubject")

  paymentFeeStructurePaymentFeeId String                @unique
  PaymentFeeStructure             PaymentFeeStructure[]
  Students                        Students[]            @relation("StudentToClass")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Model for Subjects
// Many to Many Relationship with Teachers and Students
// Junction Table
model Subjects {
  id   String @id @default(uuid())
  name String @unique

  class    Classes[]  @relation("ClassToSubject")
  teachers Teachers[] @relation("TeacherToSubject")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Model for Students Payments
// Many to One Relationship with Students

model Payment {
  id        String           @id @default(uuid())
  amount    Float
  status    PaymentStatus    @default(UNPAID)
  frequency PaymentFrequency
  mode      ModeOfPayment
  studentId String

  Students   Students     @relation(fields: [studentId], references: [id])
  PaymentFee PaymentFee[]

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  studentsId String?
}

// Model for Hardcoded Payment Fees for each grade level
// Payment Fee Structure can have many payment fees

// Model for Payment Fees
// Payment Fee can be part of many payment fee structures
model PaymentFee {
  id     String         @id @default(uuid())
  type   PaymentFeeType
  amount Float

  paymentId           String
  Payment             Payment               @relation(fields: [paymentId], references: [id])
  paymentFeeStructure PaymentFeeStructure[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Join Table for Payment Fee Structure and Class
// Many to Many Relationship with Payment Fee Structure and Payment Fee
// Many to One Relationship with Classes
model PaymentFeeStructure {
  paymentFeeId String
  PaymentFee   PaymentFee @relation(fields: [paymentFeeId], references: [id])
  classId      String
  Classes      Classes    @relation(fields: [classId], references: [id])

  compositeId String @unique @default(uuid())

  @@id([paymentFeeId, classId])
}
